# 递推关系与差分方程

数列的**递推关系**(Recurrence relation)，就是一个数列的第$n$项和前$n-1$项的等式。这个等式也叫**差分方程**(Difference equation)。

## 差分方程的概念

在差分方程中，一个很重要的任务就是<u>从递推关系求解出数列的通项公式</u>，这个过程称为**解差分方程**。

和数列的求和一样，求解递推关系（差分方程）也没有通用的方法。不过，下面我们会介绍一些常用的解法，能解决一部分常见的差分方程。

!!! Tip

    并不是所有的差分方程都可以给出初等解或者解析解。一个很显然的例子就是阶乘：定义数列$a_0 = 1$，$a_{n+1} = na_n$，那么这个数列就是阶乘数列$a_n = n!$，但阶乘并不是初等函数（阶乘在实数上的延拓是Gamma函数，但Gamma函数并非初等函数）。

    如果将数列的求和类比成积分，那么差分方程就应该对应微积分的微分方程。很多微分方程和差分方程都无法用解析解表示。

### 通解与特解

一个差分方程往往不止一个解，差分方程的所有解的集合称为**通解**。而其中一个特定的解，称为差分方程的**特解**。

### 初值条件

差分方程的求解过程中，往往需要伴随某些已知的条件，例如已知某一项的具体值。这些条件称为**初值条件**(initial condition)。

这个条件的作用之一就是从通解得出满足给定条件的特解。

## 一些典型的差分方程    
    
### 等差数列

等差数列的定义式是：

$$
a_n - a_{n-1} = d;
$$

这是一个典型的差分方程，在第一节中我们已经用数学归纳法证明了等差数列的通项为$a_n = a_1 + d(n-1)$。

这里我们用$a_1$表示了通项，实际上暗含了$a_1$已知的假设。也就是说，$a_1$是这个方程的初值条件。

### 等比数列

$$
\frac{a_{n+1}}{a_n} = q;
$$

### 阶乘

!!! 数列递推与编程递归

    递推与**递归**（recursive)具有一定的相似性。
    
    在数学上，递归指的是将一个问题分解为已经解决的问题，如用数学归纳法证明问题。类似地，编程上的递归也是将一个问题分解为它的子问题。

    以下我们便可以用一个递推方法编写一个阶乘函数：

    ```C
    #include <stdio.h>

    int factorial(int n){
        return n * factorial(n-1);
    }
    
    void main(){
        scanf("%d", &n);
        printf("%d", factorial(n));
    }
    ```

    ```python
    def Factorial(n : int) -> int:
        return n * Factorial(n-1)
    
    n = input()
    print(Factorial(n))
    ```

## 高中常见的差分方程解法

这些方法大多数在高中已经涉及，大家可以通过下面的内容进行温习。

如果没见过也没关系，我们会给出尽量详细的推导。

### 累加法

累加法就是将差分方程转化为一个数列的求和问题。

累加法主要适用于

$$
a_n = f(n) + a_{n-1} 
$$

型的方程。

### 累乘法

和累加法类似，累乘法解决的是

$$
{a_{n+1}} = f(n) a_n
$$

型的方程，将数列通项转化为$f(n)$的前$n$项积的计算问题。

### 转化法

转化法是将一个数列通过平移、加项等方法，变换成熟悉的数列。

最经典的例子是$a_n = k a_{n-1} + f(n)$型的数列，我们以这个数列举例：

!!! Example

    * 已知$a_n = 2 a_{n-1} + 1, a_1 = 1$，求$a_n$的通项。

    **Solution**

    这道题有多种方法：

    **Method 1**

    两边加上一个数，尝试将它配凑成等比数列的格式。经过尝试，加上1之后刚好成倍数：

    **
    a_n + 1 = 2(a_{n+1} + 1).
    **

    于是令$b_n = a_n + 1$，则数列$\{ b_n \}$构成等比数列，于是有

    $$
    b_n = b_1 2^{n-1} = 2^n.
    $$

    这样，就得到了$a_n = 2^n - 1$。

    **Method 2**

    方程两边除以$2^n$，得到：

    $$
    \frac{a_n}{2^n} = frac{a_{n-1}}{2^{n-1}} + \left(\frac{1}{2}\right)^n;
    $$

    这样，令$c_n = a_n / 2^n$，这样$\{ c_n \}$就可以用累加法进行计算。

### 取倒数法

### 取对数法

### 不动点法

## 线性常系数递推·特征方程法

### 线性常系数递推的概念

一般地，设$k$是一个固定的正整数，那么**线性常系数齐次差分方程**(Linear homogeneous diffence equation with constant coefficients)或**线性常系数齐次递推关系**(Linear homogeneous recurrence with constant coefficients)，指的是满足以下条件的方程：

$$
a_n = c_1 a_{n-1} + a_2 a_{n-2} + \cdots + c_k a_{n-k}.
$$

（其中$c_1, \dots, c_k$为常数）

这个递推关系中的每一项只与其前$k$项有关，我们将$k$称为这个递推关系式的**阶**(degree)。

而如果方程的右边还有一个固定的非零项$g(n)$，也即：

$$
a_n = c_1 a_{n-1} + a_2 a_{n-2} + \cdots + c_k a_{n-k} + g(n);
$$

则称该方程为**线性常系数非齐次差分方程**(Linear nonhomogeneous diffence equation with constant coefficients)

!!! Notation

    这类差分方程的名字中，“线性”指的是两个该形式的递推关系相加，或者与一个数（实数或复数）相乘后，仍然满足该形式；“常系数”指的是$a_{n-1},\dots,a_{n-k}$的系数均为常数，而不是某个关于$n$的函数；“齐次”指的是方程的右边只包含$a_{n-1},\dots,a_{n-k}$这些项的组合，不再包含一个非零项$g(n)$。

    因此，简单说，可以把$a_n$表示为$a_{n-1}, \dots, a_{n-k}$的**线性组合**的递推关系，称为线性常系数齐次递推关系。